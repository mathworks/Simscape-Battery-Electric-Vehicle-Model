var sourceData159 = {"FileName":"C:\\local\\github-issacito12\\fork-bev\\DetailedModelApplications\\MotorDrivePmsmFem\\MotorDrive_calcElectricEfficiency.mlx","RawFileContents":["% Load parameters","MotorDrive_testParams","","% Open model and set up simulation","mdl = \"MotorDrive_testHarness\";","if not(bdIsLoaded(mdl)), open_system(mdl); end","","set_param(mdl, ...","  'SimscapeLogOpenViewer', 'off',...","  'EnablePacing', 'off',...","  'SolverType', 'Variable-step',...","  'Solver', 'VariableStepAuto',...","  'SaveTime', 'on',...","  'TimeSaveName', 'tout',...","  'SignalLogging', 'on',...","  'SignalLoggingName', 'logsout',...","  'SimscapeLogType', 'local',...","  'SimscapeLogSimulationStatistics', 'off',...","  'SimscapeLogToSDI', 'off',...","  'SimscapeLogName', 'logsoutssc',...","  'SimscapeLogDecimation', 1,...","  'SimscapeLogLimitData', 'off',...","  'ReturnWorkspaceOutputs', 'on',...","  'ReturnWorkspaceOutputsName', 'out');","","set_param(mdl+\"/Motor Drive/FEM-Parameterized PMSM\", \"LogSimulationData\", \"on\")","  % necessary for electrical loss calculation after simulation","","tMax = 0.2;  % Simulation time > 60/rpm0/N","set_param(mdl, 'StopTime',num2str(tMax))","","set_param(mdl, 'FastRestart', 'on')","save_system(mdl)","","prjRoot = currentProject().RootFolder;","topicFolderPath = fullfile(prjRoot, \"DetailedModelApplications\", \"MotorDrivePmsmFem\");","assert(isfolder(topicFolderPath))","% The ranges specified below are rather narrow for electric vehicle motors.","% This is due to the lack of sufficient motor data for FEM-Parameterized PMSM block","% as well as to the limitation of the FOC controller used in the model.","SpeedVec = [100, 450, 800, 1150, 1500];  % rpm","TorqueVec = [10, 45, 80, 115, 150];  % N*m","nS = length(SpeedVec);","nT = length(TorqueVec);","","clear in","in(1:nS, 1:nT) = Simulink.SimulationInput(mdl);","for i_spd = 1:nS","  for i_trq = 1:nT","    rpm0 = SpeedVec(i_spd);","    torque0 = TorqueVec(i_trq);","","    % First two setBlockParameter calls are used by Simulation Manager's","    % default Figure window to show the progress of simulations.","    % First one for horizontal, left to right.","    % Second one for vertical, bottom to top.","    in(i_spd,i_trq) = in(i_spd,i_trq).setBlockParameter(mdl+\"/Constant Target Speed\", 'Value',num2str(rpm0));","    in(i_spd,i_trq) = in(i_spd,i_trq).setBlockParameter(mdl+\"/Step Load Torque\", 'After',num2str(torque0));","","    in(i_spd,i_trq) = in(i_spd,i_trq).setBlockParameter(mdl+\"/Load inertia\", 'w',num2str(rpm0));","    in(i_spd,i_trq) = in(i_spd,i_trq).setBlockParameter(mdl+\"/Motor Drive/FEM-Parameterized PMSM\", ...","                'angular_velocity',num2str(rpm0));","    in(i_spd,i_trq) = in(i_spd,i_trq).setBlockParameter(mdl+\"/Motor Drive/FEM-Parameterized PMSM\", ...","                'angular_velocity_priority','High');","  end","end","","%out = sim(in, \"ShowSimulationManager\",\"on\");","out = parsim(in, \"ShowSimulationManager\",\"on\");  % need Parallel Computing Toolbox","clear result","result(1:nS,1:nT) = struct('spd',0, 'trq',0, 'log',timeseries);","for i_spd = 1:nS  % speed","  for i_trq = 1:nT  % torque","    spd = SpeedVec(i_spd);","    trq = TorqueVec(i_trq);","    result(i_spd,i_trq).spd = spd;","    result(i_spd,i_trq).trq = trq;","    result(i_spd,i_trq).log = out(i_spd,i_trq).logsout.get(\"<motorSpd>\").Values;","  end","end","","f = figure;","f.Position(3:4) = [800 600];","tl = tiledlayout(nT, nS);","tl.TileSpacing = \"compact\";","tl.Padding = \"compact\";","title(tl, \"Motor speed for various load torques and target speeds\")","for i_trq = 1:nT  % torque","  for i_spd = 1:nS  % speed","    nexttile","    irev_trq = nT - i_trq + 1;","    plot(result(i_spd,irev_trq).log.Time, result(i_spd,irev_trq).log.Data)","    title(num2str(result(i_spd,irev_trq).trq) + \" N*m, \" + num2str(result(i_spd,irev_trq).spd) + \" rpm\")","  end","end","Losses = zeros(nS,nT);","for i_spd = 1:nS","  for i_trq = 1:nT","    rpm0_abs = abs(SpeedVec(i_spd));","    % Time range for last full AC cycle","    tMin = tMax - 60/rpm0_abs/PmsmFem.NumPolePairs;","    assert(tMin < tMax)","    % Extract losses","    tabulatedLosses = ee_getPowerLossSummary(out(i_spd,i_trq).logsoutssc, tMin, tMax);","    Losses(i_spd,i_trq) = sum(tabulatedLosses.Power);","  end","end","SpeedVecLabels = cell(1,nS);","for idx = 1:nS","  SpeedVecLabels{idx} = num2str(SpeedVec(idx));","end","","TorqueVecLabels = cell(1,nT);","for idx = 1:nT","  TorqueVecLabels{idx} = num2str(TorqueVec(idx));","end","","figure","hmap = heatmap(SpeedVecLabels, TorqueVecLabels, Losses);","hmap.YDisplayData = flip(TorqueVecLabels);","hmap.Title = \"Electrical Losses (W)\";","hmap.XLabel = \"Speed (rpm)\";","hmap.YLabel = \"Torque (N*m)\";","% Make sure the losses data is stored in a 2D matrix as Losses(SpeedVec, TorqueVec).","motorDrive.simplePmsmDrv_spdVec_rpm = SpeedVec;","motorDrive.simplePmsmDrv_trqVec_Nm = TorqueVec;","motorDrive.simplePmsmDrv_LossTbl_W = Losses;","","saveFileFullPath = fullfile(topicFolderPath, \"MotorDriveElecLossParams.mat\");","save(saveFileFullPath, \"motorDrive\");","% The file is saved in the current folder.","%disp(\"Mat file was saved in \"+pwd)"],"CoverageDisplayDataPerLine":{"Function":[],"Statement":[{"LineNumber":2,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":21,"ContinuedLine":false},{"LineNumber":5,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":31,"ContinuedLine":false},{"LineNumber":6,"Hits":[0,0],"StartColumnNumbers":[0,25],"EndColumnNumbers":[23,42],"ContinuedLine":false},{"LineNumber":8,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":13,"ContinuedLine":false},{"LineNumber":9,"Hits":0,"StartColumnNumbers":2,"EndColumnNumbers":32,"ContinuedLine":true},{"LineNumber":10,"Hits":0,"StartColumnNumbers":2,"EndColumnNumbers":23,"ContinuedLine":true},{"LineNumber":11,"Hits":0,"StartColumnNumbers":2,"EndColumnNumbers":31,"ContinuedLine":true},{"LineNumber":12,"Hits":0,"StartColumnNumbers":2,"EndColumnNumbers":30,"ContinuedLine":true},{"LineNumber":13,"Hits":0,"StartColumnNumbers":2,"EndColumnNumbers":18,"ContinuedLine":true},{"LineNumber":14,"Hits":0,"StartColumnNumbers":2,"EndColumnNumbers":24,"ContinuedLine":true},{"LineNumber":15,"Hits":0,"StartColumnNumbers":2,"EndColumnNumbers":23,"ContinuedLine":true},{"LineNumber":16,"Hits":0,"StartColumnNumbers":2,"EndColumnNumbers":32,"ContinuedLine":true},{"LineNumber":17,"Hits":0,"StartColumnNumbers":2,"EndColumnNumbers":28,"ContinuedLine":true},{"LineNumber":18,"Hits":0,"StartColumnNumbers":2,"EndColumnNumbers":42,"ContinuedLine":true},{"LineNumber":19,"Hits":0,"StartColumnNumbers":2,"EndColumnNumbers":27,"ContinuedLine":true},{"LineNumber":20,"Hits":0,"StartColumnNumbers":2,"EndColumnNumbers":33,"ContinuedLine":true},{"LineNumber":21,"Hits":0,"StartColumnNumbers":2,"EndColumnNumbers":28,"ContinuedLine":true},{"LineNumber":22,"Hits":0,"StartColumnNumbers":2,"EndColumnNumbers":31,"ContinuedLine":true},{"LineNumber":23,"Hits":0,"StartColumnNumbers":2,"EndColumnNumbers":32,"ContinuedLine":true},{"LineNumber":24,"Hits":0,"StartColumnNumbers":2,"EndColumnNumbers":39,"ContinuedLine":true},{"LineNumber":26,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":79,"ContinuedLine":false},{"LineNumber":29,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":11,"ContinuedLine":false},{"LineNumber":30,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":40,"ContinuedLine":false},{"LineNumber":32,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":35,"ContinuedLine":false},{"LineNumber":33,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":16,"ContinuedLine":false},{"LineNumber":35,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":38,"ContinuedLine":false},{"LineNumber":36,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":86,"ContinuedLine":false},{"LineNumber":37,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":33,"ContinuedLine":false},{"LineNumber":41,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":39,"ContinuedLine":false},{"LineNumber":42,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":35,"ContinuedLine":false},{"LineNumber":43,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":22,"ContinuedLine":false},{"LineNumber":44,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":23,"ContinuedLine":false},{"LineNumber":46,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":9,"ContinuedLine":false},{"LineNumber":47,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":47,"ContinuedLine":false},{"LineNumber":48,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":16,"ContinuedLine":false},{"LineNumber":49,"Hits":0,"StartColumnNumbers":2,"EndColumnNumbers":18,"ContinuedLine":false},{"LineNumber":50,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":27,"ContinuedLine":false},{"LineNumber":51,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":31,"ContinuedLine":false},{"LineNumber":57,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":109,"ContinuedLine":false},{"LineNumber":58,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":107,"ContinuedLine":false},{"LineNumber":60,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":96,"ContinuedLine":false},{"LineNumber":61,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":97,"ContinuedLine":false},{"LineNumber":62,"Hits":0,"StartColumnNumbers":16,"EndColumnNumbers":50,"ContinuedLine":true},{"LineNumber":63,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":97,"ContinuedLine":false},{"LineNumber":64,"Hits":0,"StartColumnNumbers":16,"EndColumnNumbers":52,"ContinuedLine":true},{"LineNumber":69,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":47,"ContinuedLine":false},{"LineNumber":70,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":13,"ContinuedLine":false},{"LineNumber":71,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":63,"ContinuedLine":false},{"LineNumber":72,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":16,"ContinuedLine":false},{"LineNumber":73,"Hits":0,"StartColumnNumbers":2,"EndColumnNumbers":18,"ContinuedLine":false},{"LineNumber":74,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":26,"ContinuedLine":false},{"LineNumber":75,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":27,"ContinuedLine":false},{"LineNumber":76,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":34,"ContinuedLine":false},{"LineNumber":77,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":34,"ContinuedLine":false},{"LineNumber":78,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":80,"ContinuedLine":false},{"LineNumber":82,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":11,"ContinuedLine":false},{"LineNumber":83,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":28,"ContinuedLine":false},{"LineNumber":84,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":25,"ContinuedLine":false},{"LineNumber":85,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":27,"ContinuedLine":false},{"LineNumber":86,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":23,"ContinuedLine":false},{"LineNumber":87,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":67,"ContinuedLine":false},{"LineNumber":88,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":16,"ContinuedLine":false},{"LineNumber":89,"Hits":0,"StartColumnNumbers":2,"EndColumnNumbers":18,"ContinuedLine":false},{"LineNumber":90,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":12,"ContinuedLine":false},{"LineNumber":91,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":30,"ContinuedLine":false},{"LineNumber":92,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":74,"ContinuedLine":false},{"LineNumber":93,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":104,"ContinuedLine":false},{"LineNumber":96,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":22,"ContinuedLine":false},{"LineNumber":97,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":16,"ContinuedLine":false},{"LineNumber":98,"Hits":0,"StartColumnNumbers":2,"EndColumnNumbers":18,"ContinuedLine":false},{"LineNumber":99,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":36,"ContinuedLine":false},{"LineNumber":101,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":51,"ContinuedLine":false},{"LineNumber":102,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":23,"ContinuedLine":false},{"LineNumber":104,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":86,"ContinuedLine":false},{"LineNumber":105,"Hits":0,"StartColumnNumbers":4,"EndColumnNumbers":53,"ContinuedLine":false},{"LineNumber":108,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":28,"ContinuedLine":false},{"LineNumber":109,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":14,"ContinuedLine":false},{"LineNumber":110,"Hits":0,"StartColumnNumbers":2,"EndColumnNumbers":47,"ContinuedLine":false},{"LineNumber":113,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":29,"ContinuedLine":false},{"LineNumber":114,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":14,"ContinuedLine":false},{"LineNumber":115,"Hits":0,"StartColumnNumbers":2,"EndColumnNumbers":49,"ContinuedLine":false},{"LineNumber":118,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":6,"ContinuedLine":false},{"LineNumber":119,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":56,"ContinuedLine":false},{"LineNumber":120,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":42,"ContinuedLine":false},{"LineNumber":121,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":37,"ContinuedLine":false},{"LineNumber":122,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":28,"ContinuedLine":false},{"LineNumber":123,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":29,"ContinuedLine":false},{"LineNumber":125,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":47,"ContinuedLine":false},{"LineNumber":126,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":47,"ContinuedLine":false},{"LineNumber":127,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":44,"ContinuedLine":false},{"LineNumber":129,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":77,"ContinuedLine":false},{"LineNumber":130,"Hits":0,"StartColumnNumbers":0,"EndColumnNumbers":37,"ContinuedLine":false}]}}